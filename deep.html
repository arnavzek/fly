<head>
	<style type="text/css">


		body{
			width: auto;
			width: 300vw;
			margin: 0;
		}
		section{
	height: 100%;
	width: 100vw;
	float: left;
	text-align: center;
	font-size: 20vw;
	color: #fff;
		}

		section:first-child{
			background: #111;
		}

		section:nth-child(2){
			background: tomato;
		}

		section:nth-child(3){
			background: steelblue;
		}

		section#app section{
			width: 100vw;
			height: 10vw;
			font-size: 5vw;
		}

	</style>
</head>

<body navigation='dot' deck='x' scroll='y'>
	
	<!-- switch and scroll is defined for it's child -->
	<section id="Apps" deck='y' scroll='x'>
		<p>lorem ipsum</p>
		<p>lorem ipsum</p>
		<p>lorem ipsum</p>
		<p>lorem ipsum</p>
	</section>

	<section id="Dashboard">Dashboard</section>
	<section id="search">search</section>

</body>

<script>

	//how to add navigation

	//option A instantiate navigation, no!

	//option B add add swipe feature -> tik


	// detect swipe

	var prv = {s:1,x:0,y:0}
	var active_page = document.body.children[0];
	var config = {duration:0.5}

	function move(command,element,steps){
		
		if(!element) element = active_page
		
		switch(command.toLowerCase()) {
		  case 'next':
		    element = element.nextElementSibling
		    active_page = element

		    break;
		  case 'previous':
		    element = element.previousElementSibling
		    active_page = element
		    break;
		  case 'jump':
		    active_page = element
		    break;
		  default:
		  	console.log('no changes')
		}

		history.pushState({},"", active_page.getAttribute('id') );
		onpushstate()
	}

	function open(element){
		history.pushState({},"", element.getAttribute('id') );
		onpushstate()
	}

	//bind on push state to main funtion
	//mark it in the url

	var onpushstate = function(){
	    	var urlPages = document.location.href.split("/")
	    	var page = urlPages[urlPages.length-1]
	        fly( '#'+page )
	        console.log( page )
	        document.title = page;
	}
	
	window.onpopstate = onpushstate


	//swipe is the way to navigate 

	function swipe(element,direction){
		//element which was at the swipe start position
		// if element has the direction 
		// if not do it on the parent

		//decide to deck or scroll
	}


	var _C = document.body
	let x0 = null;

	function unify(e) { return e.changedTouches ? e.changedTouches[0] : e };
	function lock(e) { x0 = unify(e).clientX };


	function move(e) {
	  if(x0 || x0 === 0) {
	    let dx = unify(e).clientX - x0, s = Math.sign(dx);
	    //check if vertical or horizontal
		//do scroll or deck
	    x0 = null
	  }
	};



	function scroll(){
		// find the closet element var element = 
		
		var dir = 'y'
		var par = active_page
		var offset = par.getAttribute('offset')

		par.getAttribute('scroll')  == 'x'? dir = 'x':null


		par.style['transition-duration'] = config.duration+'s'
		par.style['transition-timing-function'] = 'cubic-bezier(0.55, 0.06, 0.68, 0.19)'

		par.style['transform'] = 'translate'+dir.toUpperCase()+'('+element.getBoundingClientRect()[dir.toLowerCase()]+')'
	}

	//when to transform body and when to transform locally
	function deck(element){
		console.log(element)
		if (element.trim() == '#'){
			element = document.body.children[0]
			active_page = element
		} 
		if (typeof element == 'string') element = document.querySelector(element)
		if (element[0]) element = element[0]

		
		var live_parent = document.body


		if (active_page.parentElement.getAttribute('type') == 'independent') live_parent = active_page.parentElement



		//check parent if it is independent then set parent: if inde then no scaling but if not then the body will scale and translate

		
		live_parent.style['transition-duration'] = config.duration+'s'
		live_parent.style['transition-timing-function'] = 'cubic-bezier(0.55, 0.06, 0.68, 0.19)'
		zoomin()
		
		function zoomin(){
			var destination = element.getBoundingClientRect()

			var s = window.innerWidth/destination.width;
			var x = -destination.x
			var y = -destination.y

			prv.s = prv.s*s
			prv.x = prv.x + x
			prv.y = prv.y+y

			live_parent.style['transform-origin'] = 0+'px '+0+'px';
			live_parent.style.transform = ' scale('+prv.s+') translateX('+prv.x+'px)  translateY('+prv.y+'px)';
			console.log(prv.s,prv.x,prv.y)
		}
		
	}

	_C.addEventListener('mousedown', lock, false);
	_C.addEventListener('touchstart', lock, false);
	_C.addEventListener('mouseup', move, false);
	_C.addEventListener('touchend', move, false);

</script>


